!function(t){var e={},n={0:0};function r(n){if(e[n])return e[n].exports;var o=e[n]={i:n,l:!1,exports:{}};return t[n].call(o.exports,o,o.exports,r),o.l=!0,o.exports}r.e=function(e){if(0!==n[e]){var r=require("./"+e+".app.js"),o=r.modules,a=r.ids;for(var i in o)t[i]=o[i];for(var s=0;s<a.length;s++)n[a[s]]=0}return Promise.all([])},r.m=t,r.c=e,r.d=function(t,e,n){r.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:n})},r.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},r.t=function(t,e){if(1&e&&(t=r(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var n=Object.create(null);if(r.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var o in t)r.d(n,o,function(e){return t[e]}.bind(null,o));return n},r.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return r.d(e,"a",e),e},r.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},r.p="",r.oe=function(t){process.nextTick((function(){throw t}))},r(r.s=24)}([function(t,e){t.exports=require("react")},function(t,e){t.exports=require("react-router-dom")},function(t,e){t.exports=require("path")},function(t,e){t.exports={wdsPort:9002,nodeServerPort:9001,asyncComponentKey:"__IS_ASYNC_COMP_FLAG__"}},function(t,e){t.exports=require("react-router")},function(t,e){t.exports=require("assert")},function(t,e){t.exports=require("debug")},function(t,e){t.exports=require("http-errors")},function(t,e){t.exports=require("any-promise")},function(t,e){t.exports=require("react-dom/server")},function(t,e){t.exports=require("react-hot-loader/root")},function(t,e){t.exports=require("koa2")},function(t,e,n){"use strict";const r=n(6)("koa-static"),{resolve:o}=n(2),a=n(5),i=n(16);t.exports=function(t,e){e=Object.assign({},e),a(t,"root directory is required to serve files"),r('static "%s" %j',t,e),e.root=o(t),!1!==e.index&&(e.index=e.index||"index.html");if(!e.defer)return async function(t,n){let r=!1;if("HEAD"===t.method||"GET"===t.method)try{r=await i(t,t.path,e)}catch(t){if(404!==t.status)throw t}r||await n()};return async function(t,n){if(await n(),("HEAD"===t.method||"GET"===t.method)&&null==t.body&&404===t.status)try{await i(t,t.path,e)}catch(t){if(404!==t.status)throw t}}}},function(t,e){t.exports=require("react-router-config")},function(t,e,n){t.exports=function(){let t=["libs.js","main.js","styles.js"],e=["styles.css"];const r={js:[],css:[]};{const o=n(15);t.forEach(t=>{o[t]&&r.js.push(`<script type="text/javascript"  src="${o[t]}"><\/script>`)}),e.forEach(t=>{o[t]&&r.css.push(`<link rel="stylesheet" type="text/css" href="${o[t]}" />`)})}return r}},function(t){t.exports=JSON.parse('{"styles.css":"/css/styles.ca28e53a.css","styles.js":"/js/styles.c416e6cb.js","libs.js":"/js/libs.93656f11.js","main.js":"/js/main.8f0c442a.js","js/3.1a59f75e.js":"/js/3.1a59f75e.js","js/4.62f71c05.js":"/js/4.62f71c05.js","img/img.f9bd91f4.jpg":"/img/img.f9bd91f4.jpg"}')},function(t,e,n){const r=n(6)("koa-send"),o=n(17),a=n(7),i=n(5),s=n(19),{normalize:c,basename:u,extname:l,resolve:f,parse:p,sep:d}=n(2);t.exports=async function(t,e,n={}){i(t,"koa context required"),i(e,"pathname required"),r('send "%s" %j',e,n);const m=n.root?c(f(n.root)):"",h="/"===e[e.length-1];e=e.substr(p(e).root.length);const y=n.index,g=n.maxage||n.maxAge||0,b=n.immutable||!1,x=n.hidden||!1,v=!1!==n.format,_=!!Array.isArray(n.extensions)&&n.extensions,w=!1!==n.brotli,j=!1!==n.gzip,$=n.setHeaders;if($&&"function"!=typeof $)throw new TypeError("option setHeaders must be function");if(-1===(e=function(t){try{return decodeURIComponent(t)}catch(t){return-1}}(e)))return t.throw(400,"failed to decode");y&&h&&(e+=y);if(e=o(m,e),!x&&function(t,e){e=e.substr(t.length).split(d);for(let t=0;t<e.length;t++)if("."===e[t][0])return!0;return!1}(m,e))return;let E,k="";"br"===t.acceptsEncodings("br","identity")&&w&&await s.exists(e+".br")?(e+=".br",t.set("Content-Encoding","br"),t.res.removeHeader("Content-Length"),k=".br"):"gzip"===t.acceptsEncodings("gzip","identity")&&j&&await s.exists(e+".gz")&&(e+=".gz",t.set("Content-Encoding","gzip"),t.res.removeHeader("Content-Length"),k=".gz");if(_&&!/\.[^/]*$/.exec(e)){const t=[].concat(_);for(let n=0;n<t.length;n++){let r=t[n];if("string"!=typeof r)throw new TypeError("option extensions must be array of strings or false");if(/^\./.exec(r)||(r="."+r),await s.exists(e+r)){e+=r;break}}}try{if(E=await s.stat(e),E.isDirectory()){if(!v||!y)return;e+="/"+y,E=await s.stat(e)}}catch(t){if(["ENOENT","ENAMETOOLONG","ENOTDIR"].includes(t.code))throw a(404,t);throw t.status=500,t}$&&$(t.res,e,E);t.set("Content-Length",E.size),t.response.get("Last-Modified")||t.set("Last-Modified",E.mtime.toUTCString());if(!t.response.get("Cache-Control")){const e=["max-age="+(g/1e3|0)];b&&e.push("immutable"),t.set("Cache-Control",e.join(","))}t.type||(t.type=(O=e,C=k,l(""!==C?u(O,C):O)));var O,C;return t.body=s.createReadStream(e),e}},function(t,e,n){"use strict";
/*!
 * resolve-path
 * Copyright(c) 2014 Jonathan Ong
 * Copyright(c) 2015-2018 Douglas Christopher Wilson
 * MIT Licensed
 */var r=n(7),o=n(2).join,a=n(2).normalize,i=n(18),s=n(2).resolve,c=n(2).sep;t.exports=function(t,e){var n=e,l=t;1===arguments.length&&(n=t,l=process.cwd());if(null==l)throw new TypeError("argument rootPath is required");if("string"!=typeof l)throw new TypeError("argument rootPath must be a string");if(null==n)throw new TypeError("argument relativePath is required");if("string"!=typeof n)throw new TypeError("argument relativePath must be a string");if(-1!==n.indexOf("\0"))throw r(400,"Malicious Path");if(i.posix(n)||i.win32(n))throw r(400,"Malicious Path");if(u.test(a("."+c+n)))throw r(403);return a(o(s(l),n))};var u=/(?:^|[\\/])\.\.(?:[\\/]|$)/},function(t,e){t.exports=require("path-is-absolute")},function(t,e,n){var r,o=n(8);try{r=n(20)}catch(t){r=n(21)}var a=["appendFile","chmod","chown","close","fchmod","fchown","fdatasync","fstat","fsync","ftruncate","futimes","lchown","link","lstat","mkdir","open","read","readFile","readdir","readlink","realpath","rename","rmdir","stat","symlink","truncate","unlink","utimes","write","writeFile"];"function"==typeof r.access&&a.push("access"),"function"==typeof r.copyFile&&a.push("copyFile"),"function"==typeof r.mkdtemp&&a.push("mkdtemp"),n(22).withCallback(r,e,a),e.exists=function(t,e){return"function"==typeof e?r.stat(t,(function(t){e(null,!t)})):new o((function(e){r.stat(t,(function(t){e(!t)}))}))}},function(t,e){t.exports=require("graceful-fs")},function(t,e){t.exports=require("fs")},function(t,e,n){var r=n(23);function o(t,e,n){return a(t,e,n,r)}function a(t,e,n,r){return e||(e={},n=Object.keys(t)),Array.isArray(e)&&(n=e,e={}),n||(n=Object.keys(t)),"function"==typeof t&&(e=r(t)),n.forEach((function(n){"function"==typeof t[n]&&(e[n]=r(t[n]))})),Object.keys(t).forEach((function(n){(function(t,e){var n=Object.getOwnPropertyDescriptor(t,e);return!(!n||!n.get)&&"deprecated"===n.get.name})(t,n)||e[n]||(e[n]=t[n])})),e}t.exports=o,o.withCallback=function(t,e,n){return a(t,e,n,r.withCallback)},o.thenify=r},function(module,exports,__webpack_require__){var Promise=__webpack_require__(8),assert=__webpack_require__(5);function thenify($$__fn__$$,options){return assert("function"==typeof $$__fn__$$),eval(createWrapper($$__fn__$$.name,options))}function createCallback(t,e,n){return function(r,o){if(r)return e(r);var a=arguments.length;if(a<=2||!n)return t(o);if(Array.isArray(n)){for(var i={},s=1;s<a;s++)i[n[s-1]]=arguments[s];return t(i)}for(i=new Array(a-1),s=1;s<a;++s)i[s-1]=arguments[s];t(i)}}function createWrapper(t,e){t=(t||"").replace(/\s|bound(?!$)/g,"");var n=void 0===(e=e||{}).multiArgs||e.multiArgs;return"(function "+t+"() {\nvar self = this\nvar len = arguments.length\n"+(n="var multiArgs = "+JSON.stringify(n)+"\n")+(e.withCallback?'var lastType = typeof arguments[len - 1]\nif (lastType === "function") return $$__fn__$$.apply(self, arguments)\n':"")+"var args = new Array(len + 1)\nfor (var i = 0; i < len; ++i) args[i] = arguments[i]\nvar lastIndex = i\nreturn new Promise(function (resolve, reject) {\nargs[lastIndex] = createCallback(resolve, reject, multiArgs)\n$$__fn__$$.apply(self, args)\n})\n})"}module.exports=thenify,thenify.withCallback=function($$__fn__$$,options){return assert("function"==typeof $$__fn__$$),options=options||{},options.withCallback=!0,void 0===options.multiArgs&&(options.multiArgs=!0),eval(createWrapper($$__fn__$$.name,options))}},function(t,e,n){"use strict";n.r(e);var r=n(0),o=n.n(r),a=n(9),i=n(4),s=(n(13),n(1)),c=n(10);class u extends o.a.Component{constructor(t){super(t)}render(){return o.a.createElement("div",{className:"layout-box"},o.a.createElement("h1",null,"koa+react+ssr"),o.a.createElement(s.NavLink,{to:"/index",style:{marginLeft:"10px"}},"首页"),o.a.createElement(s.NavLink,{style:{marginLeft:"10px"},to:"/list"},"列表页"),this.props.children)}}var l=Object(c.hot)(u);function f(t){return o.a.createElement("div",null,"loading......")}class p extends o.a.Component{constructor(t){super(t),this.state={mod:null}}componentDidMount(){this.state.mod||this.load(this.props)}load(t){this.setState({mod:null}),t.load().then(t=>{this.setState({mod:t.default?t.default:t})})}render(){return this.state.mod?this.props.children(this.state.mod):o.a.createElement(f,null)}}var d=n(3),m=n.n(d);var h=function(t){function e(e){return o.a.createElement(p,{load:t},t=>o.a.createElement(t,e))}return e[m.a.asyncComponentKey]=!0,e};var y=[{path:["/","/index"],component:h(()=>n.e(1).then(n.bind(null,27))),exact:!0},{path:"/list",component:h(()=>n.e(2).then(n.bind(null,26))),exact:!0},{path:"*",component:function(){return o.a.createElement("div",null,"404页面")},exact:!0}];o.a.createContext({});o.a.Component;function g(){return(g=Object.assign||function(t){for(var e=1;e<arguments.length;e++){var n=arguments[e];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(t[r]=n[r])}return t}).apply(this,arguments)}function b(){return o.a.createElement("div",null,"404拉 ")}var x=function({routeList:t}){return o.a.createElement(l,null,o.a.createElement(s.Switch,null,t.map(t=>t.initialData?o.a.createElement(s.Route,{key:t.path,exact:t.exact,path:t.path,render:e=>(e.initialData=t.initialData,o.a.createElement(t.component,e))}):o.a.createElement(s.Route,g({key:t.path},t))),o.a.createElement(s.Route,{to:"*",component:b})))};const v=t=>(console.log("component.name",t[m.a.asyncComponentKey]),t[m.a.asyncComponentKey]);var _=async function(t){const e="__dynamics_route_to_static";if(global[e])return global[e];let n=t.length,r=0;const o=[];for(;r<n;r++){let e=t[r];v(e.component)?o.push({...e,component:(await e.component().props.load()).default}):o.push({...e})}return global[e]=o,o};const w=n(14);var j=n(11),$=n.n(j),E=n(12),k=n.n(E);n(2);const O=m.a.nodeServerPort||Object({NODE_ENV:"production"}).PORT,C=new $.a;C.use(k()("./dist/static")),C.use(async(t,e)=>{console.log("production"),console.log("string"),console.log(!0),console.log("boolean"),console.log("====");const n=t.request.path;if(n.indexOf(".")>-1)return t.body=null,e();console.log("ctx.request.path",t.request.path);const r=await _(y);let s=await((t,e)=>{let n,r;for(var o of e)if(r=Object(i.matchPath)(t,o),r){n=o;break}return{targetRoute:n,targetMatch:r}})(n,r),{targetRoute:c,targetMatch:u}=s,l=c.component.getInitialProps,f={};l&&(f=await l());let{page:p}=f||{},d={title:"默认标题 - my react ssr",keywords:"默认关键词",description:"默认描述"};p&&p.tdk&&(d=p.tdk);const m={initialData:f},h=Object(a.renderToString)(o.a.createElement(i.StaticRouter,{location:n,context:m},o.a.createElement(x,{routeList:r}))),g=w();t.body=`<!DOCTYPE html>\n<html lang="en">\n<head>\n    <meta charset="UTF-8">\n    <title>${d.title}</title>\n    <meta name="keywords" content="${d.keywords}" />\n    <meta name="description" content="${d.description}" />\n     ${g.css.join("")}\n</head>\n<body>\n    <div id="root">\n       ${h}\n    </div>\n    <textarea id="ssrTextInitData" style="display:none;">\n    ${JSON.stringify(f)}\n    </textarea>\n</body>\n</html>\n</body>\n ${g.js.join("")}\n`,await e()}),C.listen(O),console.log("server is start .",`http://localhost:${O}`)},function(t,e){t.exports=require("constants")}]);